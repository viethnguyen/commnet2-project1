<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Common_Classes_Projects_ECE544: SendingPort Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>SendingPort Class Reference</h1>SendingPort is an subclass of <a class="el" href="classPort.html">Port</a> for sending purpose.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="common_8h-source.html">common.h</a>&gt;</code>
<p>
<p>Inheritance diagram for SendingPort:
<p><center><img src="classSendingPort.png" usemap="#SendingPort_map" border="0" alt=""></center>
<map name="SendingPort_map">
<area href="classPort.html" alt="Port" shape="rect" coords="0,0,81,24">
</map>
<a href="classSendingPort-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a1" doxytag="SendingPort::SendingPort"></a>
&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#a1">SendingPort</a> (char *hostname, short port)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Another constructor with local address given. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="a2" doxytag="SendingPort::~SendingPort"></a>
virtual&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#a2">~SendingPort</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Deconstructor. <br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#a3">init</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#a4">sendPacket</a> (<a class="el" href="classPacket.html">Packet</a> *pkt)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#a5">setBroadcast</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#a6">setBroadcastOff</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#a7">timerHandler</a> ()=0</td></tr>

<tr><td colspan="2"><br><h2>Public Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classTxTimer.html">TxTimer</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#o0">timer_</a></td></tr>

<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#p0">bcastflag_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">this flag indicates the port ought to broadcast or unicast a packet.  <a href="#p0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSendingPort.html#p1">sendingbuf_</a></td></tr>

</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
SendingPort is an subclass of <a class="el" href="classPort.html">Port</a> for sending purpose. 
<p>
SendingPort is an subclass of <a class="el" href="classPort.html">Port</a> for sending purpose 
<p>

<p>
Definition at line <a class="el" href="common_8h-source.html#l00307">307</a> of file <a class="el" href="common_8h-source.html">common.h</a>.<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a3" doxytag="SendingPort::init"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SendingPort::init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Function to initialize the port 
<p>
Implements <a class="el" href="classPort.html#a2">Port</a>.
<p>
Definition at line <a class="el" href="common_8cpp-source.html#l00365">365</a> of file <a class="el" href="common_8cpp-source.html">common.cpp</a>.
<p>
References <a class="el" href="common_8h-source.html#l00346">bcastflag_</a>, <a class="el" href="common_8h-source.html#l00167">Address::getPort()</a>, <a class="el" href="common_8h-source.html#l00161">Address::isSet()</a>, <a class="el" href="common_8h-source.html#l00251">Port::itsaddr_</a>, <a class="el" href="common_8h-source.html#l00250">Port::myaddr_</a>, <a class="el" href="common_8h-source.html#l00252">Port::mySockAddress_</a>, <a class="el" href="common_8h-source.html#l00350">sendingbuf_</a>, <a class="el" href="common_8h-source.html#l00239">Port::setHostname()</a>, <a class="el" href="common_8h-source.html#l00241">Port::setPort()</a>, <a class="el" href="common_8cpp-source.html#l00287">Port::setSockAddress()</a>, and <a class="el" href="common_8h-source.html#l00254">Port::sockfd_</a>.<div class="fragment"><pre class="fragment">00366 {
00367   <span class="comment">//"0" shows the sockfd is uninitialized, -1 means error</span>
00368   <span class="keywordflow">if</span> (<a class="code" href="classPort.html#p4">sockfd_</a> != 0) {
00369     cout &lt;&lt; <span class="stringliteral">"socket has not been properly initialized!"</span> &lt;&lt; endl;
00370     <span class="keywordflow">return</span>;
00371   }
00372   <span class="keywordflow">if</span> ( <a class="code" href="classPort.html#p0">myaddr_</a>.<a class="code" href="classAddress.html#a2">isSet</a>() == <span class="keyword">false</span>) {
00373     <a class="code" href="classPort.html#b2">setHostname</a>(<span class="stringliteral">"localhost"</span>);
00374     <a class="code" href="classPort.html#b3">setPort</a>(DEFAULT_SEND_PORT);
00375   }
00376   <span class="comment">//check if itsaddr_ is set</span>
00377   <span class="keywordflow">if</span> ( <a class="code" href="classPort.html#p1">itsaddr_</a>.<a class="code" href="classAddress.html#a2">isSet</a>() == <span class="keyword">false</span>)
00378     <span class="keywordflow">throw</span> <span class="stringliteral">"Destination address of a sending port is not set!"</span>;
00379 
00380   <span class="keywordflow">if</span> ((<a class="code" href="classPort.html#p4">sockfd_</a> = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) {
00381     perror(<span class="stringliteral">"socket"</span>);
00382     <span class="keywordflow">throw</span> <span class="stringliteral">"Error while opening a UDP socket"</span>;
00383   }
00384   <a class="code" href="classAddress.html">Address</a> *emptyAddr = <span class="keyword">new</span> <a class="code" href="classAddress.html">Address</a>(<span class="stringliteral">""</span>, <a class="code" href="classPort.html#p0">myaddr_</a>.<a class="code" href="classAddress.html#a4">getPort</a>());
00385   <span class="keyword">struct </span>sockaddr* addr = <a class="code" href="classPort.html#b0">setSockAddress</a>(emptyAddr, &amp;<a class="code" href="classPort.html#p2">mySockAddress_</a>);
00386   <span class="keywordflow">if</span> (  bind(<a class="code" href="classPort.html#p4">sockfd_</a>, addr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in))  &lt; 0 ){
00387     perror(<span class="stringliteral">"bind"</span>);
00388     <span class="keywordflow">throw</span> <span class="stringliteral">"Scoket Bind Error"</span>;
00389   }
00390    
00391   <span class="keywordflow">if</span> (<a class="code" href="classSendingPort.html#p0">bcastflag_</a> == 1) 
00392     <span class="keywordflow">if</span> (setsockopt(<a class="code" href="classPort.html#p4">sockfd_</a>,SOL_SOCKET,SO_BROADCAST,&amp;<a class="code" href="classSendingPort.html#p0">bcastflag_</a>,<span class="keyword">sizeof</span>(<a class="code" href="classSendingPort.html#p0">bcastflag_</a>)) == -1   )
00393          {
00394            perror(<span class="stringliteral">"setsockopt"</span>);
00395            <span class="keywordflow">throw</span> <span class="stringliteral">"Set broadcast option failed."</span>;
00396          }; 
00397 
00398   <span class="comment">//create sending buffer</span>
00399   <a class="code" href="classSendingPort.html#p1">sendingbuf_</a> = <span class="keyword">new</span> <span class="keywordtype">char</span>[MTU_SIZE+1];
00400   <span class="keywordflow">return</span>; 
00401 
00402 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a4" doxytag="SendingPort::sendPacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SendingPort::sendPacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="classPacket.html">Packet</a> *&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>pkt</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Function to send a packet. The default socket file descriptor will always be used for send() only a sockfd used by the port. 
<p>
Definition at line <a class="el" href="common_8cpp-source.html#l00409">409</a> of file <a class="el" href="common_8cpp-source.html">common.cpp</a>.
<p>
References <a class="el" href="common_8h-source.html#l00253">Port::dstSockAddress_</a>, <a class="el" href="common_8h-source.html#l00230">Port::getRemoteAddr()</a>, <a class="el" href="common_8cpp-source.html#l00120">Packet::makePacket()</a>, <a class="el" href="common_8h-source.html#l00350">sendingbuf_</a>, <a class="el" href="common_8cpp-source.html#l00287">Port::setSockAddress()</a>, and <a class="el" href="common_8h-source.html#l00254">Port::sockfd_</a>.<div class="fragment"><pre class="fragment">00410 {  
00411    <span class="keywordtype">int</span> pktlen = pkt-&gt;<a class="code" href="classPacket.html#a10">makePacket</a>(<a class="code" href="classSendingPort.html#p1">sendingbuf_</a>); 
00412    <a class="code" href="classAddress.html">Address</a> *dst = <a class="code" href="classPort.html#a5">getRemoteAddr</a>();
00413    <span class="keywordtype">int</span>  length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr_in); 
00414    <span class="keyword">struct </span>sockaddr *dest = <a class="code" href="classPort.html#b0">setSockAddress</a>(dst, &amp;<a class="code" href="classPort.html#p3">dstSockAddress_</a>);
00415    <span class="keywordtype">int</span> len = sendto(<a class="code" href="classPort.html#p4">sockfd_</a>, <a class="code" href="classSendingPort.html#p1">sendingbuf_</a>, pktlen, 0, dest, length); 
00416    <span class="keywordflow">if</span> (len == -1) 
00417    { 
00418          perror(<span class="stringliteral">"send"</span>);
00419          <span class="keywordflow">throw</span> <span class="stringliteral">"Sending Error."</span>;
00420    }
00421 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a5" doxytag="SendingPort::setBroadcast"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SendingPort::setBroadcast           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
toggle broadcast option on 
<p>
Definition at line <a class="el" href="common_8h-source.html#l00328">328</a> of file <a class="el" href="common_8h-source.html">common.h</a>.
<p>
References <a class="el" href="common_8h-source.html#l00346">bcastflag_</a>.<div class="fragment"><pre class="fragment">00328 {<a class="code" href="classSendingPort.html#p0">bcastflag_</a> = 1;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a6" doxytag="SendingPort::setBroadcastOff"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void SendingPort::setBroadcastOff           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [inline]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
toggle broadcast option off 
<p>
Definition at line <a class="el" href="common_8h-source.html#l00332">332</a> of file <a class="el" href="common_8h-source.html">common.h</a>.
<p>
References <a class="el" href="common_8h-source.html#l00346">bcastflag_</a>.<div class="fragment"><pre class="fragment">00332 {<a class="code" href="classSendingPort.html#p0">bcastflag_</a> = 0;}
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a7" doxytag="SendingPort::timerHandler"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">virtual void SendingPort::timerHandler           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [pure virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
TimerHandler is called when the <a class="el" href="classTxTimer.html">TxTimer</a> expires. This function is virtual. So another child class has to be derived from this base class to use the timer. 
<p>
Referenced by <a class="el" href="common_8cpp-source.html#l00542">TxTimer::timerProc()</a>.    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="SendingPort::bcastflag_"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">int <a class="el" href="classSendingPort.html#p0">SendingPort::bcastflag_</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
this flag indicates the port ought to broadcast or unicast a packet. 
<p>
If broadcast, an broadcast IP address (192.168.255.255, etc) need to be supplied 
<p>
Definition at line <a class="el" href="common_8h-source.html#l00346">346</a> of file <a class="el" href="common_8h-source.html">common.h</a>.
<p>
Referenced by <a class="el" href="common_8cpp-source.html#l00365">init()</a>, <a class="el" href="common_8h-source.html#l00328">setBroadcast()</a>, and <a class="el" href="common_8h-source.html#l00332">setBroadcastOff()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="p1" doxytag="SendingPort::sendingbuf_"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">char* <a class="el" href="classSendingPort.html#p1">SendingPort::sendingbuf_</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Sending buffer 
<p>
Definition at line <a class="el" href="common_8h-source.html#l00350">350</a> of file <a class="el" href="common_8h-source.html">common.h</a>.
<p>
Referenced by <a class="el" href="common_8cpp-source.html#l00365">init()</a>, and <a class="el" href="common_8cpp-source.html#l00409">sendPacket()</a>.    </td>
  </tr>
</table>
<a class="anchor" name="o0" doxytag="SendingPort::timer_"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classTxTimer.html">TxTimer</a> <a class="el" href="classSendingPort.html#o0">SendingPort::timer_</a>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The timer used to schedule future events in a sending port. When this timer expires, the timerHandler will be called. 
<p>
Definition at line <a class="el" href="common_8h-source.html#l00357">357</a> of file <a class="el" href="common_8h-source.html">common.h</a>.    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="common_8h-source.html">common.h</a><li><a class="el" href="common_8cpp-source.html">common.cpp</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Fri Feb 17 17:55:49 2006 for Common_Classes_Projects_ECE544 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
