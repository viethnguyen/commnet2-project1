<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Common_Classes_Projects_ECE544: ReceivingPort Class Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.2 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a></div>
<h1>ReceivingPort Class Reference</h1>A Receiving <a class="el" href="classPort.html">Port</a> Class.  
<a href="#_details">More...</a>
<p>
<code>#include &lt;<a class="el" href="common_8h-source.html">common.h</a>&gt;</code>
<p>
<p>Inheritance diagram for ReceivingPort:
<p><center><img src="classReceivingPort.png" usemap="#ReceivingPort_map" border="0" alt=""></center>
<map name="ReceivingPort_map">
<area href="classPort.html" alt="Port" shape="rect" coords="0,0,124,24">
<area href="classLossyReceivingPort.html" alt="LossyReceivingPort" shape="rect" coords="0,112,124,136">
</map>
<a href="classReceivingPort-members.html">List of all members.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReceivingPort.html#a0">ReceivingPort</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReceivingPort.html#a2">init</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classPacket.html">Packet</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReceivingPort.html#a3">receivePacket</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The main receive function of receiving port to receive a single packet.  <a href="#a3"></a><br></td></tr>
<tr><td colspan="2"><br><h2>Protected Attributes</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="classPacket.html">Packet</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReceivingPort.html#p0">pkt_</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="anchor" name="p1" doxytag="ReceivingPort::tmpBuffer_"></a>
char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classReceivingPort.html#p1">tmpBuffer_</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">temporary buffer for packets <br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
A Receiving <a class="el" href="classPort.html">Port</a> Class. 
<p>
ReceivingPort is an abstract class for the interface to receive a packet. The main function for the receiving port:<ul>
<li>initialize</li><li>Receive <a class="el" href="classPacket.html">Packet</a> </li></ul>

<p>

<p>
Definition at line <a class="el" href="common_8h-source.html#l00369">369</a> of file <a class="el" href="common_8h-source.html">common.h</a>.<hr><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" name="a0" doxytag="ReceivingPort::ReceivingPort"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">ReceivingPort::ReceivingPort           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Constructor 
<p>
Definition at line <a class="el" href="common_8cpp-source.html#l00429">429</a> of file <a class="el" href="common_8cpp-source.html">common.cpp</a>.
<p>
References <a class="el" href="common_8h-source.html#l00382">pkt_</a>.<div class="fragment"><pre class="fragment">00429                             : <a class="code" href="classPort.html#a0">Port</a>()
00430 {
00431   <a class="code" href="classReceivingPort.html#p0">pkt_</a>= <span class="keyword">new</span> <a class="code" href="classPacket.html">Packet</a>(MAXBUFLENGTH);
00432 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Function Documentation</h2>
<a class="anchor" name="a2" doxytag="ReceivingPort::init"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top">void ReceivingPort::init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap><code> [virtual]</code></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Init Funciton to initialize a socket port.<p>
The port binds to its own address, generate a UDP socket.<p>
Bind to local address is one important task in <a class="el" href="classReceivingPort.html#a2">init()</a> Here source address of node itself (myaddr_) does not really be used by bind function of port. The program use INADDR_ANY as the address filled in address parameters of bind(). So, we need an empty hostname with the port number.<p>
When the UDP port is recieving, we need to create a default buffer to store received packet. The data in buffer will be copy to the corresponding flow once the packet's sender address is checked. 
<p>
Implements <a class="el" href="classPort.html#a2">Port</a>.
<p>
Definition at line <a class="el" href="common_8cpp-source.html#l00448">448</a> of file <a class="el" href="common_8cpp-source.html">common.cpp</a>.
<p>
References <a class="el" href="common_8h-source.html#l00167">Address::getPort()</a>, <a class="el" href="common_8h-source.html#l00161">Address::isSet()</a>, <a class="el" href="common_8h-source.html#l00250">Port::myaddr_</a>, <a class="el" href="common_8h-source.html#l00252">Port::mySockAddress_</a>, <a class="el" href="common_8h-source.html#l00239">Port::setHostname()</a>, <a class="el" href="common_8h-source.html#l00241">Port::setPort()</a>, <a class="el" href="common_8cpp-source.html#l00287">Port::setSockAddress()</a>, <a class="el" href="common_8h-source.html#l00254">Port::sockfd_</a>, and <a class="el" href="common_8h-source.html#l00383">tmpBuffer_</a>.<div class="fragment"><pre class="fragment">00449 { 
00450   <span class="keywordflow">if</span> (<a class="code" href="classPort.html#p4">sockfd_</a> != 0) {
00451     <span class="keywordflow">return</span>;
00452   }
00453   <span class="keywordflow">if</span> ( <a class="code" href="classPort.html#p0">myaddr_</a>.<a class="code" href="classAddress.html#a2">isSet</a>() == <span class="keyword">false</span>) {
00454     <a class="code" href="classPort.html#b2">setHostname</a>(<span class="stringliteral">"localhost"</span>);
00455     <a class="code" href="classPort.html#b3">setPort</a>(DEFAULT_RECV_PORT);
00456   }
00457   
00458   <span class="keywordflow">if</span> ((<a class="code" href="classPort.html#p4">sockfd_</a> = socket(AF_INET, SOCK_DGRAM, 0)) &lt; 0) {
00459     <span class="keywordflow">throw</span> <span class="stringliteral">"Error while opening UDP socket of a receiver"</span>;
00460   }
00461   <a class="code" href="classAddress.html">Address</a> *emptyAddr = <span class="keyword">new</span> <a class="code" href="classAddress.html">Address</a>(<span class="stringliteral">""</span>, <a class="code" href="classPort.html#p0">myaddr_</a>.<a class="code" href="classAddress.html#a4">getPort</a>());
00462   <span class="keyword">struct </span>sockaddr* addr = <a class="code" href="classPort.html#b0">setSockAddress</a>(emptyAddr, &amp;<a class="code" href="classPort.html#p2">mySockAddress_</a>);
00463   <span class="keywordflow">if</span> (  bind(<a class="code" href="classPort.html#p4">sockfd_</a>, addr, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> sockaddr_in))  &lt; 0 ){
00464     <span class="keywordflow">throw</span> <span class="stringliteral">"Scoket Bind Error occured in an UDP receiver"</span>;
00465   }
00466   <span class="comment">//cout &lt;&lt; "binding to port: " &lt;&lt; myaddr_.getPort() &lt;&lt; "......" &lt;&lt; endl;</span>
00467   <span class="comment">// needs a dummy buffer for storing packets</span>
00468   <a class="code" href="classReceivingPort.html#p1">tmpBuffer_</a> =  <span class="keyword">new</span> <span class="keywordtype">char</span>[MAXBUFLENGTH];
00469 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<a class="anchor" name="a3" doxytag="ReceivingPort::receivePacket"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classPacket.html">Packet</a> * ReceivingPort::receivePacket           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
The main receive function of receiving port to receive a single packet. 
<p>
The main receive function of a receiving port. First,check addresses. Then call recvfrom() to get a packet. after this, pkt_ variable stores information of the packet and tmpSockAddr stores the sender information. then, recast tmpSockAddr to itsaddr_. As the socket is not set as non-blocking, the recvfrom() call blocks usually, but if the main program use select() to do synchronized I/O Multiplexing, this call will not block.<p>
The design structure allows a future implementation improvement.<p>
packet size is the maximum allowed packet above UDP or buffer size 
<p>
Reimplemented in <a class="el" href="classLossyReceivingPort.html#a2">LossyReceivingPort</a>.
<p>
Definition at line <a class="el" href="common_8cpp-source.html#l00484">484</a> of file <a class="el" href="common_8cpp-source.html">common.cpp</a>.
<p>
References <a class="el" href="common_8cpp-source.html#l00325">Port::decodeSockAddress()</a>, <a class="el" href="common_8cpp-source.html#l00133">Packet::extractHeader()</a>, <a class="el" href="common_8cpp-source.html#l00107">Packet::fillPayload()</a>, <a class="el" href="common_8h-source.html#l00125">Packet::getHeaderSize()</a>, <a class="el" href="common_8h-source.html#l00251">Port::itsaddr_</a>, <a class="el" href="common_8h-source.html#l00382">pkt_</a>, <a class="el" href="common_8h-source.html#l00254">Port::sockfd_</a>, and <a class="el" href="common_8h-source.html#l00383">tmpBuffer_</a>.
<p>
Referenced by <a class="el" href="common_8cpp-source.html#l00514">LossyReceivingPort::receivePacket()</a>.<div class="fragment"><pre class="fragment">00485 {
00486   <span class="keyword">struct </span>sockaddr_in tmpSockAddr;
00487   <span class="keywordtype">int</span> length = <span class="keyword">sizeof</span>(<span class="keyword">struct </span>sockaddr);
00488   <span class="keywordtype">int</span> len = (int)recvfrom(<a class="code" href="classPort.html#p4">sockfd_</a>, <a class="code" href="classReceivingPort.html#p1">tmpBuffer_</a>, MAXBUFLENGTH, 0, (<span class="keyword">struct</span> sockaddr*)&amp;tmpSockAddr,(socklen_t *)&amp;length); 
00489   <span class="keywordflow">if</span> (len == -1) 
00490   {
00491            perror(<span class="stringliteral">"recvfrom"</span>);
00492            <span class="keywordflow">return</span> <span class="keyword">false</span>;
00493   }         
00494   <a class="code" href="classPort.html#b1">decodeSockAddress</a>( &amp;<a class="code" href="classPort.html#p1">itsaddr_</a>, &amp;tmpSockAddr);
00495   <a class="code" href="classReceivingPort.html#p0">pkt_</a>-&gt;<a class="code" href="classPacket.html#a9">extractHeader</a>(<a class="code" href="classReceivingPort.html#p1">tmpBuffer_</a>);
00496   <span class="comment">//tmpBuffer_ pointer shall not be moved/shifted,it will reused by the receiving port.</span>
00497   <a class="code" href="classReceivingPort.html#p0">pkt_</a>-&gt;<a class="code" href="classPacket.html#a2">fillPayload</a>(len-1-<a class="code" href="classReceivingPort.html#p0">pkt_</a>-&gt;<a class="code" href="classPacket.html#a7">getHeaderSize</a>(), <a class="code" href="classReceivingPort.html#p1">tmpBuffer_</a>+<a class="code" href="classReceivingPort.html#p0">pkt_</a>-&gt;<a class="code" href="classPacket.html#a7">getHeaderSize</a>()+1 );
00498   <span class="keywordflow">return</span> <a class="code" href="classReceivingPort.html#p0">pkt_</a>;
00499 }
</pre></div>
<p>
    </td>
  </tr>
</table>
<hr><h2>Member Data Documentation</h2>
<a class="anchor" name="p0" doxytag="ReceivingPort::pkt_"></a><p>
<table class="mdTable" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"><a class="el" href="classPacket.html">Packet</a>* <a class="el" href="classReceivingPort.html#p0">ReceivingPort::pkt_</a><code> [protected]</code>          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing="5" cellpadding="0" border="0">
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
This pointer points to the packet. This packet is just received. 
<p>
Definition at line <a class="el" href="common_8h-source.html#l00382">382</a> of file <a class="el" href="common_8h-source.html">common.h</a>.
<p>
Referenced by <a class="el" href="common_8cpp-source.html#l00484">receivePacket()</a>, and <a class="el" href="common_8cpp-source.html#l00429">ReceivingPort()</a>.    </td>
  </tr>
</table>
<hr>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="common_8h-source.html">common.h</a><li><a class="el" href="common_8cpp-source.html">common.cpp</a></ul>
<hr size="1"><address style="align: right;"><small>Generated on Fri Feb 17 17:55:49 2006 for Common_Classes_Projects_ECE544 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.2 </small></address>
</body>
</html>
